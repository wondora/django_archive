upstream django {
    server web:8000;
}

server {
    listen 80;
    server_name f.fji.kr;

    # ==========================================
    # 1. 용량 및 타임아웃 설정 (요청하신 부분)
    # ==========================================
    
    # [용량] 1GB 파일 업로드 허용 (기본값은 1MB라 이거 없으면 큰 파일 에러남)
    client_max_body_size 1G;

    # [시간] Gunicorn의 300초(5분) 설정과 맞춤
    # (이게 짧으면 파이썬은 열심히 일하고 있는데 Nginx가 "왜 대답 안 해?" 하고 끊어버림)
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    proxy_read_timeout 300s;

    # ==========================================
    # 2. 정적 파일 & 미디어 설정 (CSS 깨짐 방지)
    # ==========================================

    # [필수] MIME 타입 (이게 없으면 CSS가 텍스트로 인식돼서 깨짐)
    include /etc/nginx/mime.types;

    # 정적 파일 (CSS, JS)
    location /static/ {
        alias /app/static/;
    }

    # 미디어 파일 (업로드한 이미지/영상)
    location /media/ {
        alias /app/media/;
    }

    # ==========================================
    # 3. Django 애플리케이션 연결
    # ==========================================
    location / {
        proxy_pass http://django;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}